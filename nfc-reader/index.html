<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>NFC reader</title>
    <meta name="description" content="yee" />

    <style>
      /* TEMP */
    </style>
  </head>
  <body>
    <p>Please tap your card!</p>
    <button id="scan">start scanning</button>
    <script>
      // window.onerror = (message, source, lineno, colno, error) => {
      //   alert(
      //     `error: ${JSON.stringify({ message, source, lineno, colno, error })}`
      //   )
      // }
      // window.onunhandledrejection = e => {
      //   alert(`rejection: ${e.reason.stack}`)
      // }
      const ws = new WebSocket('ws://localhost:3000/')
      const reader = new NDEFReader()
      reader.addEventListener('reading', e => {
        new Audio('./success.wav').play()
        const audio = new Audio('./scan-success.mp3')
        audio.volume = 0.7
        audio.play()
        ws.send(JSON.stringify({
          type: 'tap-card',
          id: e.serialNumber
        }))
      })
      reader.addEventListener('readingerror', () => {
        new Audio('./error.wav').play()
        const audio = new Audio('./scan-error.mp3')
        audio.volume = 0.7
        audio.play()
        ws.send(JSON.stringify({
          type: 'tap-card-error'
        }))
      })
      scan.onclick = () => reader.scan().then(() => {
        scan.disabled = true
        new Audio('./scan-ready.mp3').play()
      })
    </script>
  </body>
</html>
